(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{724:function(e,t,a){"use strict";a.r(t);var s=a(1),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"data-structures"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-structures"}},[e._v("#")]),e._v(" Data Structures")]),e._v(" "),a("p",[e._v("Here we describe the data structures in the Tendermint blockchain and the rules for validating them.")]),e._v(" "),a("p",[e._v("The Tendermint blockchains consists of a short list of basic data types:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("Block")])]),e._v(" "),a("li",[a("code",[e._v("Header")])]),e._v(" "),a("li",[a("code",[e._v("Version")])]),e._v(" "),a("li",[a("code",[e._v("BlockID")])]),e._v(" "),a("li",[a("code",[e._v("Time")])]),e._v(" "),a("li",[a("code",[e._v("Data")]),e._v(" (for transactions)")]),e._v(" "),a("li",[a("code",[e._v("Commit")]),e._v(" and "),a("code",[e._v("Vote")])]),e._v(" "),a("li",[a("code",[e._v("EvidenceData")]),e._v(" and "),a("code",[e._v("Evidence")])])]),e._v(" "),a("h2",{attrs:{id:"block"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#block"}},[e._v("#")]),e._v(" Block")]),e._v(" "),a("p",[e._v("A block consists of a header, transactions, votes (the commit),\nand a list of evidence of malfeasance (ie. signing conflicting votes).")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBCbG9jayBzdHJ1Y3QgewogICAgSGVhZGVyICAgICAgSGVhZGVyCiAgICBUeHMgICAgICAgICBEYXRhCiAgICBFdmlkZW5jZSAgICBFdmlkZW5jZURhdGEKICAgIExhc3RDb21taXQgIENvbW1pdAp9Cg=="}}),e._v(" "),a("p",[e._v("Note the "),a("code",[e._v("LastCommit")]),e._v(" is the set of signatures of validators that committed the last block.")]),e._v(" "),a("h2",{attrs:{id:"header"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#header"}},[e._v("#")]),e._v(" Header")]),e._v(" "),a("p",[e._v("A block header contains metadata about the block and about the consensus, as well as commitments to\nthe data in the current block, the previous block, and the results returned by the application:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBIZWFkZXIgc3RydWN0IHsKIC8vIGJhc2ljIGJsb2NrIGluZm8KIFZlcnNpb24gIFZlcnNpb24KIENoYWluSUQgIHN0cmluZwogSGVpZ2h0ICAgaW50NjQKIFRpbWUgICAgIFRpbWUKCiAvLyBwcmV2IGJsb2NrIGluZm8KIExhc3RCbG9ja0lEIEJsb2NrSUQKCiAvLyBoYXNoZXMgb2YgYmxvY2sgZGF0YQogTGFzdENvbW1pdEhhc2ggW11ieXRlIC8vIGNvbW1pdCBmcm9tIHZhbGlkYXRvcnMgZnJvbSB0aGUgbGFzdCBibG9jawogRGF0YUhhc2ggICAgICAgW11ieXRlIC8vIE1lcmtsZVJvb3Qgb2YgdHJhbnNhY3Rpb24gaGFzaGVzCgogLy8gaGFzaGVzIGZyb20gdGhlIGFwcCBvdXRwdXQgZnJvbSB0aGUgcHJldiBibG9jawogVmFsaWRhdG9yc0hhc2ggICAgIFtdYnl0ZSAvLyB2YWxpZGF0b3JzIGZvciB0aGUgY3VycmVudCBibG9jawogTmV4dFZhbGlkYXRvcnNIYXNoIFtdYnl0ZSAvLyB2YWxpZGF0b3JzIGZvciB0aGUgbmV4dCBibG9jawogQ29uc2Vuc3VzSGFzaCAgICAgIFtdYnl0ZSAvLyBjb25zZW5zdXMgcGFyYW1zIGZvciBjdXJyZW50IGJsb2NrCiBBcHBIYXNoICAgICAgICAgICAgW11ieXRlIC8vIHN0YXRlIGFmdGVyIHR4cyBmcm9tIHRoZSBwcmV2aW91cyBibG9jawogTGFzdFJlc3VsdHNIYXNoICAgIFtdYnl0ZSAvLyByb290IGhhc2ggb2YgYWxsIHJlc3VsdHMgZnJvbSB0aGUgdHhzIGZyb20gdGhlIHByZXZpb3VzIGJsb2NrCgogLy8gY29uc2Vuc3VzIGluZm8KIEV2aWRlbmNlSGFzaCAgICBbXWJ5dGUgLy8gZXZpZGVuY2UgaW5jbHVkZWQgaW4gdGhlIGJsb2NrCiBQcm9wb3NlckFkZHJlc3MgW11ieXRlIC8vIG9yaWdpbmFsIHByb3Bvc2VyIG9mIHRoZSBibG9jawo="}}),e._v(" "),a("p",[e._v("Further details on each of these fields is described below.")]),e._v(" "),a("h2",{attrs:{id:"version"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#version"}},[e._v("#")]),e._v(" Version")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBWZXJzaW9uIHN0cnVjdCB7CiBCbG9jayB1aW50NjQKIEFwcCAgIHVpbnQ2NAp9Cg=="}}),e._v(" "),a("p",[e._v("The "),a("code",[e._v("Version")]),e._v(" contains the protocol version for the blockchain and the\napplication as two "),a("code",[e._v("uint64")]),e._v(" values.")]),e._v(" "),a("h2",{attrs:{id:"blockid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blockid"}},[e._v("#")]),e._v(" BlockID")]),e._v(" "),a("p",[e._v("The "),a("code",[e._v("BlockID")]),e._v(" contains two distinct Merkle roots of the block.\nThe first, used as the block's main hash, is the MerkleRoot\nof all the fields in the header (ie. "),a("code",[e._v("MerkleRoot(header)")]),e._v(".\nThe second, used for secure gossipping of the block during consensus,\nis the MerkleRoot of the complete serialized block\ncut into parts (ie. "),a("code",[e._v("MerkleRoot(MakeParts(block))")]),e._v(").\nThe "),a("code",[e._v("BlockID")]),e._v(" includes these two hashes, as well as the number of\nparts (ie. "),a("code",[e._v("len(MakeParts(block))")]),e._v(")")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBCbG9ja0lEIHN0cnVjdCB7CiAgICBIYXNoIFtdYnl0ZQogICAgUGFydFNldEhlYWRlciBQYXJ0U2V0SGVhZGVyCn0KCnR5cGUgUGFydFNldEhlYWRlciBzdHJ1Y3QgewogICAgVG90YWwgdWludDMyCiAgICBIYXNoIFtdYnl0ZQp9Cg=="}}),e._v(" "),a("p",[e._v("See "),a("RouterLink",{attrs:{to:"/spec/core/encoding.html#MerkleRoot"}},[e._v("MerkleRoot")]),e._v(" for details.")],1),e._v(" "),a("h2",{attrs:{id:"time"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#time"}},[e._v("#")]),e._v(" Time")]),e._v(" "),a("p",[e._v("Tendermint uses the\n"),a("a",{attrs:{href:"https://developers.google.com/protocol-buffers/docs/reference/csharp/class/google/protobuf/well-known-types/timestamp",target:"_blank",rel:"noopener noreferrer"}},[e._v("Google.Protobuf.WellKnownTypes.Timestamp"),a("OutboundLink")],1),e._v("\nformat, which uses two integers, one for Seconds and for Nanoseconds.")]),e._v(" "),a("h2",{attrs:{id:"data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data"}},[e._v("#")]),e._v(" Data")]),e._v(" "),a("p",[e._v("Data is just a wrapper for a list of transactions, where transactions are\narbitrary byte arrays:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBEYXRhIHN0cnVjdCB7CiAgICBUeHMgW11bXWJ5dGUKfQo="}}),e._v(" "),a("h2",{attrs:{id:"commit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commit"}},[e._v("#")]),e._v(" Commit")]),e._v(" "),a("p",[e._v("Commit is a simple wrapper for a list of signatures, with one for each\nvalidator. It also contains the relevant BlockID, height and round:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBDb21taXQgc3RydWN0IHsKIEhlaWdodCAgICAgaW50NjQKIFJvdW5kICAgICAgaW50MzIKIEJsb2NrSUQgICAgQmxvY2tJRAogU2lnbmF0dXJlcyBbXUNvbW1pdFNpZwp9Cg=="}}),e._v(" "),a("h2",{attrs:{id:"commitsig"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#commitsig"}},[e._v("#")]),e._v(" CommitSig")]),e._v(" "),a("p",[a("code",[e._v("CommitSig")]),e._v(" represents a signature of a validator, who has voted either for nil,\na particular "),a("code",[e._v("BlockID")]),e._v(" or was absent. It's a part of the "),a("code",[e._v("Commit")]),e._v(" and can be used\nto reconstruct the vote set given the validator set.")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBCbG9ja0lERmxhZyBieXRlCgpjb25zdCAoCiAvLyBCbG9ja0lERmxhZ0Fic2VudCAtIG5vIHZvdGUgd2FzIHJlY2VpdmVkIGZyb20gYSB2YWxpZGF0b3IuCiBCbG9ja0lERmxhZ0Fic2VudCBCbG9ja0lERmxhZyA9IDB4MDEKIC8vIEJsb2NrSURGbGFnQ29tbWl0IC0gdm90ZWQgZm9yIHRoZSBDb21taXQuQmxvY2tJRC4KIEJsb2NrSURGbGFnQ29tbWl0ID0gMHgwMgogLy8gQmxvY2tJREZsYWdOaWwgLSB2b3RlZCBmb3IgbmlsLgogQmxvY2tJREZsYWdOaWwgPSAweDAzCikKCnR5cGUgQ29tbWl0U2lnIHN0cnVjdCB7CiBCbG9ja0lERmxhZyAgICAgIEJsb2NrSURGbGFnCiBWYWxpZGF0b3JBZGRyZXNzIEFkZHJlc3MKIFRpbWVzdGFtcCAgICAgICAgdGltZS5UaW1lCiBTaWduYXR1cmUgICAgICAgIFtdYnl0ZQp9Cg=="}}),e._v(" "),a("p",[e._v("NOTE: "),a("code",[e._v("ValidatorAddress")]),e._v(" and "),a("code",[e._v("Timestamp")]),e._v(" fields may be removed in the future\n(see\n"),a("a",{attrs:{href:"https://github.com/tendermint/tendermint/blob/master/docs/architecture/adr-025-commit.md",target:"_blank",rel:"noopener noreferrer"}},[e._v("ADR-25"),a("OutboundLink")],1),e._v(").")]),e._v(" "),a("h2",{attrs:{id:"vote"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vote"}},[e._v("#")]),e._v(" Vote")]),e._v(" "),a("p",[e._v("A vote is a signed message from a validator for a particular block.\nThe vote includes information about the validator signing it.")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBWb3RlIHN0cnVjdCB7CiBUeXBlICAgICAgICAgICAgIFNpZ25lZE1zZ1R5cGUKIEhlaWdodCAgICAgICAgICAgaW50NjQKIFJvdW5kICAgICAgICAgICAgaW50MzIKIEJsb2NrSUQgICAgICAgICAgQmxvY2tJRAogVGltZXN0YW1wICAgICAgICBUaW1lCiBWYWxpZGF0b3JBZGRyZXNzIFtdYnl0ZQogVmFsaWRhdG9ySW5kZXggICBpbnQzMgogU2lnbmF0dXJlICAgICAgICBbXWJ5dGUKfQo="}}),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"protobuf",base64:"ZW51bSBTaWduZWRNc2dUeXBlIHsKICBTSUdORURfTVNHX1RZUEVfVU5LTk9XTiA9IDA7CiAgLy8gVm90ZXMKICBQUkVWT1RFX1RZUEUgICA9IDE7CiAgUFJFQ09NTUlUX1RZUEUgPSAyOwogIC8vIFByb3Bvc2FscwogIFBST1BPU0FMX1RZUEUgPSAzMjsKfQo="}}),e._v(" "),a("p",[e._v("There are two types of votes:\na "),a("em",[e._v("prevote")]),e._v(" has "),a("code",[e._v("vote.Type == 1")]),e._v(" and\na "),a("em",[e._v("precommit")]),e._v(" has "),a("code",[e._v("vote.Type == 2")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"signature"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#signature"}},[e._v("#")]),e._v(" Signature")]),e._v(" "),a("p",[e._v("Signatures in Tendermint are raw bytes representing the underlying signature.")]),e._v(" "),a("p",[e._v("See the "),a("RouterLink",{attrs:{to:"/spec/core/encoding.html#key-types"}},[e._v("signature spec")]),e._v(" for more.")],1),e._v(" "),a("h2",{attrs:{id:"evidencedata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#evidencedata"}},[e._v("#")]),e._v(" EvidenceData")]),e._v(" "),a("p",[e._v("EvidenceData is a simple wrapper for a list of evidence:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBFdmlkZW5jZURhdGEgc3RydWN0IHsKICAgIEV2aWRlbmNlIFtdRXZpZGVuY2UKfQo="}}),e._v(" "),a("h2",{attrs:{id:"evidence"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#evidence"}},[e._v("#")]),e._v(" Evidence")]),e._v(" "),a("p",[e._v("Evidence in Tendermint is used to indicate breaches in the consensus by a validator.\nIt is implemented as the following interface.")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBFdmlkZW5jZSBpbnRlcmZhY2UgewogSGVpZ2h0KCkgaW50NjQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGVpZ2h0IG9mIHRoZSBlcXVpdm9jYXRpb24KIEJ5dGVzKCkgW11ieXRlICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ5dGVzIHdoaWNoIGNvbXByaXNlIHRoZSBldmlkZW5jZQogSGFzaCgpIFtdYnl0ZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGFzaCBvZiB0aGUgZXZpZGVuY2UgKHRoaXMgaXMgYWxzbyB1c2VkIGZvciBlcXVhbGl0eSkKIFZhbGlkYXRlQmFzaWMoKSBlcnJvciAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNpc3RlbmN5IGNoZWNrIG9mIHRoZSBkYXRhCiBTdHJpbmcoKSBzdHJpbmcgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGV2aWRlbmNlCn0K"}}),e._v(" "),a("p",[e._v("All evidence can be encoded and decoded to and from Protobuf with the "),a("code",[e._v("EvidenceToProto()")]),e._v("\nand "),a("code",[e._v("EvidenceFromProto()")]),e._v(" functions. The "),a("RouterLink",{attrs:{to:"/spec/consensus/light-client/accountability.html"}},[e._v("Fork Accountability")]),e._v("\ndocument provides a good overview for the types of evidence and how they occur. For evidence to be committed onchain, it must adhere to the validation rules of each evidence and must not be expired. The expiration age, measured in both block height and time is set in "),a("code",[e._v("EvidenceParams")]),e._v(". Each evidence uses\nthe timestamp of the block that the evidence occured at to indicate the age of the evidence.")],1),e._v(" "),a("h3",{attrs:{id:"duplicatevoteevidence"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#duplicatevoteevidence"}},[e._v("#")]),e._v(" DuplicateVoteEvidence")]),e._v(" "),a("p",[a("code",[e._v("DuplicateVoteEvidence")]),e._v(" represents a validator that has voted for two different blocks\nin the same round of the same height. Votes are lexicographically sorted on "),a("code",[e._v("BlockID")]),e._v(".")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBEdXBsaWNhdGVWb3RlRXZpZGVuY2Ugc3RydWN0IHsKICAgIFZvdGVBICAqVm90ZQogICAgVm90ZUIgICpWb3RlCn0K"}}),e._v(" "),a("p",[e._v("Valid Duplicate Vote Evidence must adhere to the following rules:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Validator Address, Height, Round and Type must be the same for both votes")])]),e._v(" "),a("li",[a("p",[e._v("BlockID must be different for both votes (BlockID can be for a nil block)")])]),e._v(" "),a("li",[a("p",[e._v("Validator must have been in the validator set at that height")])]),e._v(" "),a("li",[a("p",[e._v("Vote signature must be valid (using the chainID)")])]),e._v(" "),a("li",[a("p",[e._v("Evidence must not have expired: either age in terms of height or time must be\nless than the age stated in the consensus params. Time is the block time that the\nvotes were a part of.")])])]),e._v(" "),a("h3",{attrs:{id:"lightclientattackevidence"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lightclientattackevidence"}},[e._v("#")]),e._v(" LightClientAttackEvidence")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"dHlwZSBMaWdodENsaWVudEF0dGFja0V2aWRlbmNlIHN0cnVjdCB7CiBDb25mbGljdGluZ0Jsb2NrICpMaWdodEJsb2NrCiBDb21tb25IZWlnaHQgICAgIGludDY0Cn0K"}}),e._v(" "),a("p",[e._v("Valid Light Client Attack Evidence encompasses three types of attack and must adhere to the following rules")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("If the header of the light block is invalid, thus indicating a lunatic attack, the node must check that\nthey can use "),a("code",[e._v("verifySkipping")]),e._v(" from their header at the common height to the conflicting header")])]),e._v(" "),a("li",[a("p",[e._v("If the header is valid, then the validator sets are the same and this is either a form of equivocation\nor amnesia. We therefore check that 2/3 of the validator set also signed the conflicting header")])]),e._v(" "),a("li",[a("p",[e._v("The trusted header of the node at the same height as the conflicting header must have a different hash to\nthe conflicting header.")])]),e._v(" "),a("li",[a("p",[e._v("Evidence must not have expired. The height (and thus the time) is taken from the common height.")])])]),e._v(" "),a("h2",{attrs:{id:"validation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#validation"}},[e._v("#")]),e._v(" Validation")]),e._v(" "),a("p",[e._v("Here we describe the validation rules for every element in a block.\nBlocks which do not satisfy these rules are considered invalid.")]),e._v(" "),a("p",[e._v("We abuse notation by using something that looks like Go, supplemented with English.\nA statement such as "),a("code",[e._v("x == y")]),e._v(" is an assertion - if it fails, the item is invalid.")]),e._v(" "),a("p",[e._v("We refer to certain globally available objects:\n"),a("code",[e._v("block")]),e._v(" is the block under consideration,\n"),a("code",[e._v("prevBlock")]),e._v(" is the "),a("code",[e._v("block")]),e._v(" at the previous height,\nand "),a("code",[e._v("state")]),e._v(" keeps track of the validator set, the consensus parameters\nand other results from the application. At the point when "),a("code",[e._v("block")]),e._v(" is the block under consideration,\nthe current version of the "),a("code",[e._v("state")]),e._v(" corresponds to the state\nafter executing transactions from the "),a("code",[e._v("prevBlock")]),e._v(".\nElements of an object are accessed as expected,\nie. "),a("code",[e._v("block.Header")]),e._v(".\nSee the "),a("RouterLink",{attrs:{to:"/spec/core/state.html"}},[e._v("definition of "),a("code",[e._v("State")])]),e._v(".")],1),e._v(" "),a("h3",{attrs:{id:"header-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#header-2"}},[e._v("#")]),e._v(" Header")]),e._v(" "),a("p",[e._v("A Header is valid if its corresponding fields are valid.")]),e._v(" "),a("h3",{attrs:{id:"version-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#version-2"}},[e._v("#")]),e._v(" Version")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suVmVyc2lvbi5CbG9jayA9PSBzdGF0ZS5WZXJzaW9uLkNvbnNlbnN1cy5CbG9jawpibG9jay5WZXJzaW9uLkFwcCA9PSBzdGF0ZS5WZXJzaW9uLkNvbnNlbnN1cy5BcHAK"}}),e._v(" "),a("p",[e._v("The block version must match consensus version from the state.")]),e._v(" "),a("h3",{attrs:{id:"chainid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chainid"}},[e._v("#")]),e._v(" ChainID")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"bGVuKGJsb2NrLkNoYWluSUQpICZsdDsgNTAK"}}),e._v(" "),a("p",[e._v("ChainID must be less than 50 bytes.")]),e._v(" "),a("h3",{attrs:{id:"height"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#height"}},[e._v("#")]),e._v(" Height")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suSGVhZGVyLkhlaWdodCAmZ3Q7IDAKYmxvY2suSGVhZGVyLkhlaWdodCAmZ3Q7PSBzdGF0ZS5Jbml0aWFsSGVpZ2h0CmJsb2NrLkhlYWRlci5IZWlnaHQgPT0gcHJldkJsb2NrLkhlYWRlci5IZWlnaHQgKyAxCg=="}}),e._v(" "),a("p",[e._v("The height is an incrementing integer. The first block has "),a("code",[e._v("block.Header.Height == state.InitialHeight")]),e._v(", derived from the genesis file.")]),e._v(" "),a("h3",{attrs:{id:"time-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#time-2"}},[e._v("#")]),e._v(" Time")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suSGVhZGVyLlRpbWVzdGFtcCAmZ3Q7PSBwcmV2QmxvY2suSGVhZGVyLlRpbWVzdGFtcCArIHN0YXRlLmNvbnNlbnN1c1BhcmFtcy5CbG9jay5UaW1lSW90YU1zCmJsb2NrLkhlYWRlci5UaW1lc3RhbXAgPT0gTWVkaWFuVGltZShibG9jay5MYXN0Q29tbWl0LCBzdGF0ZS5MYXN0VmFsaWRhdG9ycykK"}}),e._v(" "),a("p",[e._v("The block timestamp must be monotonic.\nIt must equal the weighted median of the timestamps of the valid signatures in the block.LastCommit.")]),e._v(" "),a("p",[e._v("Note: the timestamp of a vote must be greater by at least one millisecond than that of the\nblock being voted on.")]),e._v(" "),a("p",[e._v("The timestamp of the first block must be equal to the genesis time (since\nthere's no votes to compute the median).")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgYmxvY2suSGVhZGVyLkhlaWdodCA9PSBzdGF0ZS5Jbml0aWFsSGVpZ2h0IHsKICAgIGJsb2NrLkhlYWRlci5UaW1lc3RhbXAgPT0gZ2VuZXNpc1RpbWUKfQo="}}),e._v(" "),a("p",[e._v("See the section on "),a("RouterLink",{attrs:{to:"/spec/consensus/bft-time.html"}},[e._v("BFT time")]),e._v(" for more details.")],1),e._v(" "),a("h3",{attrs:{id:"lastblockid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lastblockid"}},[e._v("#")]),e._v(" LastBlockID")]),e._v(" "),a("p",[e._v("LastBlockID is the previous block's BlockID:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cHJldkJsb2NrUGFydHMgOj0gTWFrZVBhcnRzKHByZXZCbG9jaykKYmxvY2suSGVhZGVyLkxhc3RCbG9ja0lEID09IEJsb2NrSUQgewogICAgSGFzaDogTWVya2xlUm9vdChwcmV2QmxvY2suSGVhZGVyKSwKICAgIFBhcnRzSGVhZGVyewogICAgICAgIEhhc2g6IE1lcmtsZVJvb3QocHJldkJsb2NrUGFydHMpLAogICAgICAgIFRvdGFsOiBsZW4ocHJldkJsb2NrUGFydHMpLAogICAgfSwKfQo="}}),e._v(" "),a("p",[e._v("The first block has "),a("code",[e._v("block.Header.LastBlockID == BlockID{}")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"lastcommithash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lastcommithash"}},[e._v("#")]),e._v(" LastCommitHash")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suSGVhZGVyLkxhc3RDb21taXRIYXNoID09IE1lcmtsZVJvb3QoYmxvY2suTGFzdENvbW1pdC5TaWduYXR1cmVzKQo="}}),e._v(" "),a("p",[e._v("MerkleRoot of the signatures included in the block.\nThese are the commit signatures of the validators that committed the previous\nblock.")]),e._v(" "),a("p",[e._v("The first block has "),a("code",[e._v("block.Header.LastCommitHash == []byte{}")])]),e._v(" "),a("h3",{attrs:{id:"datahash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#datahash"}},[e._v("#")]),e._v(" DataHash")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suSGVhZGVyLkRhdGFIYXNoID09IE1lcmtsZVJvb3QoSGFzaGVzKGJsb2NrLlR4cy5UeHMpKQo="}}),e._v(" "),a("p",[e._v("MerkleRoot of the hashes of transactions included in the block.")]),e._v(" "),a("p",[e._v("Note the transactions are hashed before being included in the Merkle tree,\nso the leaves of the Merkle tree are the hashes, not the transactions\nthemselves. This is because transaction hashes are regularly used as identifiers for\ntransactions.")]),e._v(" "),a("h3",{attrs:{id:"validatorshash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#validatorshash"}},[e._v("#")]),e._v(" ValidatorsHash")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suVmFsaWRhdG9yc0hhc2ggPT0gTWVya2xlUm9vdChzdGF0ZS5WYWxpZGF0b3JzKQo="}}),e._v(" "),a("p",[e._v("MerkleRoot of the current validator set that is committing the block.\nThis can be used to validate the "),a("code",[e._v("LastCommit")]),e._v(" included in the next block.\nNote that before computing the MerkleRoot the validators are sorted\nfirst by voting power (descending), then by address (ascending).")]),e._v(" "),a("h3",{attrs:{id:"nextvalidatorshash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nextvalidatorshash"}},[e._v("#")]),e._v(" NextValidatorsHash")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suTmV4dFZhbGlkYXRvcnNIYXNoID09IE1lcmtsZVJvb3Qoc3RhdGUuTmV4dFZhbGlkYXRvcnMpCg=="}}),e._v(" "),a("p",[e._v("MerkleRoot of the next validator set that will be the validator set that commits the next block.\nThis is included so that the current validator set gets a chance to sign the\nnext validator sets Merkle root.\nNote that before computing the MerkleRoot the validators are sorted\nfirst by voting power (descending), then by address (ascending).")]),e._v(" "),a("h3",{attrs:{id:"consensushash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consensushash"}},[e._v("#")]),e._v(" ConsensusHash")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suQ29uc2Vuc3VzSGFzaCA9PSBzdGF0ZS5Db25zZW5zdXNQYXJhbXMuSGFzaCgpCg=="}}),e._v(" "),a("p",[e._v("Hash of the protobuf-encoding of a subset of the consensus parameters.")]),e._v(" "),a("h3",{attrs:{id:"apphash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apphash"}},[e._v("#")]),e._v(" AppHash")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suQXBwSGFzaCA9PSBzdGF0ZS5BcHBIYXNoCg=="}}),e._v(" "),a("p",[e._v("Arbitrary byte array returned by the application after executing and commiting the previous block. It serves as the basis for validating any merkle proofs that comes from the ABCI application and represents the state of the actual application rather than the state of the blockchain itself.")]),e._v(" "),a("p",[e._v("The first block's "),a("code",[e._v("block.Header.AppHash")]),e._v(" is given by "),a("code",[e._v("ResponseInitChain.app_hash")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"lastresultshash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lastresultshash"}},[e._v("#")]),e._v(" LastResultsHash")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suTGFzdFJlc3VsdHNIYXNoID09IE1lcmtsZVJvb3QoW11SZXNwb25zZURlbGl2ZXJUeCkK"}}),e._v(" "),a("p",[a("code",[e._v("LastResultsHash")]),e._v(" is the root hash of a Merkle tree built from "),a("code",[e._v("ResponseDeliverTx")]),e._v(" responses ("),a("code",[e._v("Log")]),e._v(","),a("code",[e._v("Info")]),e._v(", "),a("code",[e._v("Codespace")]),e._v(" and "),a("code",[e._v("Events")]),e._v(" fields are ignored).")]),e._v(" "),a("p",[e._v("The first block has "),a("code",[e._v("block.Header.ResultsHash == MerkleRoot(nil)")]),e._v(", i.e. the hash of an empty input, for RFC-6962 conformance.")]),e._v(" "),a("h2",{attrs:{id:"evidencehash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#evidencehash"}},[e._v("#")]),e._v(" EvidenceHash")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suRXZpZGVuY2VIYXNoID09IE1lcmtsZVJvb3QoYmxvY2suRXZpZGVuY2UpCg=="}}),e._v(" "),a("p",[e._v("MerkleRoot of the evidence of Byzantine behaviour included in this block.")]),e._v(" "),a("h3",{attrs:{id:"proposeraddress"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proposeraddress"}},[e._v("#")]),e._v(" ProposerAddress")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"YmxvY2suSGVhZGVyLlByb3Bvc2VyQWRkcmVzcyBpbiBzdGF0ZS5WYWxpZGF0b3JzCg=="}}),e._v(" "),a("p",[e._v("Address of the original proposer of the block. Must be a current validator.")]),e._v(" "),a("h2",{attrs:{id:"txs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#txs"}},[e._v("#")]),e._v(" Txs")]),e._v(" "),a("p",[e._v("Arbitrary length array of arbitrary length byte-arrays.")]),e._v(" "),a("h2",{attrs:{id:"lastcommit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lastcommit"}},[e._v("#")]),e._v(" LastCommit")]),e._v(" "),a("p",[e._v("The first height is an exception - it requires the "),a("code",[e._v("LastCommit")]),e._v(" to be empty:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"aWYgYmxvY2suSGVhZGVyLkhlaWdodCA9PSBzdGF0ZS5Jbml0aWFsSGVpZ2h0IHsKICBsZW4oYi5MYXN0Q29tbWl0KSA9PSAwCn0K"}}),e._v(" "),a("p",[e._v("Otherwise, we require:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"bGVuKGJsb2NrLkxhc3RDb21taXQpID09IGxlbihzdGF0ZS5MYXN0VmFsaWRhdG9ycykKCnRhbGxpZWRWb3RpbmdQb3dlciA6PSAwCmZvciBpLCBjb21taXRTaWcgOj0gcmFuZ2UgYmxvY2suTGFzdENvbW1pdC5TaWduYXR1cmVzIHsKICBpZiBjb21taXRTaWcuQWJzZW50KCkgewogICAgY29udGludWUKICB9CgogIHZvdGUuQmxvY2tJRCA9PSBibG9jay5MYXN0QmxvY2tJRAoKICB2YWwgOj0gc3RhdGUuTGFzdFZhbGlkYXRvcnNbaV0KICB2b3RlLlZlcmlmeShibG9jay5DaGFpbklELCB2YWwuUHViS2V5KSA9PSB0cnVlCgogIHRhbGxpZWRWb3RpbmdQb3dlciArPSB2YWwuVm90aW5nUG93ZXIKfQoKdGFsbGllZFZvdGluZ1Bvd2VyICZndDsgKDIvMykqVG90YWxWb3RpbmdQb3dlcihzdGF0ZS5MYXN0VmFsaWRhdG9ycykK"}}),e._v(" "),a("p",[e._v("Includes one vote for every current validator.\nAll votes must either be for the previous block, nil or absent.\nAll votes must have a valid signature from the corresponding validator.\nThe sum total of the voting power of the validators that voted\nmust be greater than 2/3 of the total voting power of the complete validator set.")]),e._v(" "),a("p",[e._v("The number of votes in a commit is limited to 10000 (see "),a("code",[e._v("types.MaxVotesCount")]),e._v(").")]),e._v(" "),a("h3",{attrs:{id:"vote-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vote-2"}},[e._v("#")]),e._v(" Vote")]),e._v(" "),a("p",[e._v("A vote is a signed message broadcast in the consensus for a particular block at a particular height and round.\nWhen stored in the blockchain or propagated over the network, votes are encoded in Protobuf.\nFor signing, votes are represented via "),a("code",[e._v("CanonicalVote")]),e._v(" and also encoded using Protobuf via\n"),a("code",[e._v("VoteSignBytes")]),e._v(" which includes the "),a("code",[e._v("ChainID")]),e._v(", and uses a different ordering of\nthe fields.")]),e._v(" "),a("p",[e._v("We define a method "),a("code",[e._v("Verify")]),e._v(" that returns "),a("code",[e._v("true")]),e._v(" if the signature verifies against the pubkey for the "),a("code",[e._v("SignBytes")]),e._v("\nusing the given ChainID:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAodm90ZSAqVm90ZSkgVmVyaWZ5KGNoYWluSUQgc3RyaW5nLCBwdWJLZXkgY3J5cHRvLlB1YktleSkgZXJyb3IgewogaWYgIWJ5dGVzLkVxdWFsKHB1YktleS5BZGRyZXNzKCksIHZvdGUuVmFsaWRhdG9yQWRkcmVzcykgewogIHJldHVybiBFcnJWb3RlSW52YWxpZFZhbGlkYXRvckFkZHJlc3MKIH0KCiBpZiAhcHViS2V5LlZlcmlmeUJ5dGVzKHZvdGUuU2lnbkJ5dGVzKGNoYWluSUQpLCB2b3RlLlNpZ25hdHVyZSkgewogIHJldHVybiBFcnJWb3RlSW52YWxpZFNpZ25hdHVyZQogfQogcmV0dXJuIG5pbAp9Cg=="}}),e._v(" "),a("p",[e._v("where "),a("code",[e._v("pubKey.Verify")]),e._v(" performs the appropriate digital signature verification of the "),a("code",[e._v("pubKey")]),e._v("\nagainst the given signature and message bytes.")]),e._v(" "),a("h2",{attrs:{id:"execution"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#execution"}},[e._v("#")]),e._v(" Execution")]),e._v(" "),a("p",[e._v("Once a block is validated, it can be executed against the state.")]),e._v(" "),a("p",[e._v("The state follows this recursive equation:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"c3RhdGUoaW5pdGlhbEhlaWdodCkgPSBJbml0aWFsU3RhdGUKc3RhdGUoaCsxKSAmbHQ7LSBFeGVjdXRlKHN0YXRlKGgpLCBBQkNJQXBwLCBibG9jayhoKSkK"}}),e._v(" "),a("p",[e._v("where "),a("code",[e._v("InitialState")]),e._v(" includes the initial consensus parameters and validator set,\nand "),a("code",[e._v("ABCIApp")]),e._v(" is an ABCI application that can return results and changes to the validator\nset (TODO). Execute is defined as:")]),e._v(" "),a("code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyBFeGVjdXRlKHMgU3RhdGUsIGFwcCBBQkNJQXBwLCBibG9jayBCbG9jaykgU3RhdGUgewogLy8gRnVjdGlvbiBBcHBseUJsb2NrIGV4ZWN1dGVzIGJsb2NrIG9mIHRyYW5zYWN0aW9ucyBhZ2FpbnN0IHRoZSBhcHAgYW5kIHJldHVybnMgdGhlIG5ldyByb290IGhhc2ggb2YgdGhlIGFwcCBzdGF0ZSwKIC8vIG1vZGlmaWNhdGlvbnMgdG8gdGhlIHZhbGlkYXRvciBzZXQgYW5kIHRoZSBjaGFuZ2VzIG9mIHRoZSBjb25zZW5zdXMgcGFyYW1ldGVycy4KIEFwcEhhc2gsIFZhbGlkYXRvckNoYW5nZXMsIENvbnNlbnN1c1BhcmFtQ2hhbmdlcyA6PSBhcHAuQXBwbHlCbG9jayhibG9jaykKCiBuZXh0Q29uc2Vuc3VzUGFyYW1zIDo9IFVwZGF0ZUNvbnNlbnN1c1BhcmFtcyhzdGF0ZS5Db25zZW5zdXNQYXJhbXMsIENvbnNlbnN1c1BhcmFtQ2hhbmdlcykKIHJldHVybiBTdGF0ZXsKICBDaGFpbklEOiAgICAgICAgIHN0YXRlLkNoYWluSUQsCiAgSW5pdGlhbEhlaWdodDogICBzdGF0ZS5Jbml0aWFsSGVpZ2h0LAogIExhc3RSZXN1bHRzOiAgICAgYWJjaVJlc3BvbnNlcy5EZWxpdmVyVHhSZXN1bHRzLAogIEFwcEhhc2g6ICAgICAgICAgQXBwSGFzaCwKICBJbml0aWFsSGVpZ2h0OiAgIHN0YXRlLkluaXRpYWxIZWlnaHQsCiAgTGFzdFZhbGlkYXRvcnM6ICBzdGF0ZS5WYWxpZGF0b3JzLAogIFZhbGlkYXRvcnM6ICAgICAgc3RhdGUuTmV4dFZhbGlkYXRvcnMsCiAgTmV4dFZhbGlkYXRvcnM6ICBVcGRhdGVWYWxpZGF0b3JzKHN0YXRlLk5leHRWYWxpZGF0b3JzLCBWYWxpZGF0b3JDaGFuZ2VzKSwKICBDb25zZW5zdXNQYXJhbXM6IG5leHRDb25zZW5zdXNQYXJhbXMsCiAgVmVyc2lvbjogewogICBDb25zZW5zdXM6IHsKICAgIEFwcFZlcnNpb246IG5leHRDb25zZW5zdXNQYXJhbXMuVmVyc2lvbi5BcHBWZXJzaW9uLAogICB9LAogIH0sCiB9Cn0K"}})],1)}),[],!1,null,null,null);t.default=o.exports}}]);